<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../deep-hybrid-behavior/deep-hybrid-behavior.html">

<!-- TODO: Handle additional config file types -->
<!--
  TODO: How to handle filtering config data. I.e, polymer equivalent to nodejs
  const { host } = require('configuration.json');
 -->

<dom-module id="deep-configuration">
  <template>
    <iron-ajax
      url="[[filePath]]"
      handle-as="json"
    ></iron-ajax>
  </template>
  <script>
    /**
     * `deep-configuration`
     * Polymer component providing access to configuration throughout an application.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
     Polymer({
       is: 'deep-configuration',
       behaviors: [
         deep.HybridBehavior
       ],
       properties: {
         /* Path to the configuration file */
         filePath: {
           type: String,
           value: './config.json'
         },
         /* Public hook into configurations */
         configurations: {
           type: Object,
           value() {
             return {};
           },
           notify: true
         },
         /* Indicates when configuration has completed. True means complete. False otherwise. */
         complete: {
           type: Boolean,
           value: false,
           notify: true
         }
       },
       attached() {
         let configurations = {};
         this.querySelector('iron-ajax').generateRequest().completes.then(({response}) => {
           if (response) configurations = response;
         }, () => {
           console.error(`${this.localName}: fetching configuration file at path '${this.filePath}' failed. Configurations will be empty.`);
         }).then(() => {
           this.set('configurations', configurations);
         }).then(() => {
           this.set('complete', true);
         });
       }
     });
  </script>
</dom-module>
